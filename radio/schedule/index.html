<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>KiwiSDR.fr - Planificateur de Stations</title>

    <!-- Open Graph Metadata -->
    <meta property="og:title" content="KiwiSDR.fr | Planificateur de Stations" />
    <meta property="og:description" content="KiwiSDR.fr - Planificateur des √©missions radios mondiales programm√©es." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="http://kiwisdr.fr/radio/schedule/" />
    <meta property="og:image" content="http://kiwisdr.fr/assets/img/og-image.png" />

    <!-- Favicon & Styles -->
    <link rel="icon" type="image/x-icon" href="http://kiwisdr.fr/assets/img/favicon.ico" />
    <link rel="stylesheet" href="http://kiwisdr.fr/assets/css/main.css" />
    <link rel="stylesheet" href="./main.css">
    
    <!-- i18n System -->
    <script src="../../assets/js/i18n.js"></script>
    
    <style>
        .language-selector {
            display: flex;
            gap: 0.5em;
            justify-content: center;
            margin-top: 1em;
        }
        
        .lang-btn {
            background: linear-gradient(135deg, rgba(0, 200, 255, 0.15) 0%, rgba(100, 50, 200, 0.1) 100%);
            border: 2px solid rgba(0, 255, 200, 0.2);
            color: #00ffcc;
            padding: 0.5em 1em;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .lang-btn:hover {
            border-color: rgba(0, 255, 200, 0.5);
            box-shadow: 0 4px 15px rgba(0, 200, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .lang-btn.sel {
            background: linear-gradient(135deg, #00ffcc 0%, #00ddff 100%);
            border-color: #00ffcc;
            color: #0a0e27;
            box-shadow: 0 8px 25px rgba(0, 255, 204, 0.4);
            font-weight: 700;
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header>
        <div class="header-logo">
            <img 
                src="http://kiwisdr.fr/assets/img/og-image.png" 
                alt="KiwiSDR Logo" 
                class="logo"
            />
        </div>

        <div class="header-text">
            <h1>KiwiSDR.fr</h1>
            <p id="schedule-subtitle">üìÖ Planificateur de Stations Radio Mondial</p>
            
            <!-- Language Selector -->
            <div class="language-selector">
                <button class="lang-btn sel" onclick="setLanguage('fr')">üá´üá∑ FR</button>
                <button class="lang-btn" onclick="setLanguage('en')">üá¨üáß EN</button>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav>
        <a href="http://kiwisdr.fr/" id="nav-home">Accueil</a>
        <a href="#schedule" id="nav-schedule">Horaires</a>
        <a href="#info" id="nav-info">Infos</a>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Radio Waves Animation -->
        <div class="radio-waves">
            <span></span><span></span><span></span><span></span><span></span>
        </div>

        <section id="schedule">
            <h2 id="schedule-title">üì° Calendrier des √âmissions</h2>
            <div class="schedule"></div>
        </section>

        <!-- Info Section -->
        <section id="info" style="margin-top: 2em;">
            <h3 id="schedule-about">‚ÑπÔ∏è √Ä Propos du Planificateur</h3>
            <p id="schedule-about-desc">
                Ce planificateur affiche les √©missions radio programm√©es de stations exp√©rimentales 
                et officielles du monde entier. Consultez les horaires UTC et planifiez vos sessions 
                de r√©ception!
            </p>
        </section>
    </main>

    <script>
async function loadSchedule() {
    const scheduleContainer = document.querySelector('.schedule');
    const dayNames = {
        mon: "Lundi",
        tue: "Mardi",
        wed: "Mercredi",
        thu: "Jeudi",
        fri: "Vendredi",
        sat: "Samedi",
        sun: "Dimanche"
    };

    try {
        const response = await fetch('./sc.json');
        const data = await response.json();

        const wrapper = document.createElement('div');
        wrapper.className = 'radio-schedule';

        // Horloge UTC
        const clock = document.createElement('div');
        clock.className = 'utc-clock';
        clock.innerHTML = `
            <h3>‚è±Ô∏è Heure UTC Actuelle</h3>
            <div id="utc-time">--:--:--</div>
        `;
        wrapper.appendChild(clock);

        // Conteneur principal
        const tableContainer = document.createElement('div');
        tableContainer.className = 'table-container';

        // Regroupement par jour
        const daysMap = {};
        data.forEach(entry => {
            const days = entry.day.split(',');
            days.forEach(day => {
                if (!daysMap[day]) daysMap[day] = [];
                daysMap[day].push(entry);
            });
        });

        // G√©n√©ration du contenu
        Object.keys(dayNames).forEach(dayKey => {
            const dayEntries = daysMap[dayKey];
            if (!dayEntries) return;

            const allEntries = [];

            // Expansion de chaque horaire pour tri global
            dayEntries.forEach(entry => {
                const hours = entry.hour.split(',');
                hours.forEach(hour => {
                    allEntries.push({
                        hour,
                        name: entry.name,
                        freq: entry.freq || '-',
                        mode: entry.mode || '-',
                        com: entry.com || '-'
                    });
                });
            });

            // Tri par heure
            allEntries.sort((a, b) => {
                const ah = parseInt(a.hour.slice(0, 2));
                const am = parseInt(a.hour.slice(2) || '0');
                const bh = parseInt(b.hour.slice(0, 2));
                const bm = parseInt(b.hour.slice(2) || '0');
                return (ah * 60 + am) - (bh * 60 + bm);
            });

            // Titre du jour
            const dayHeader = document.createElement('h3');
            dayHeader.className = 'day-header';
            dayHeader.textContent = 'üìÖ ' + dayNames[dayKey];
            dayHeader.style.marginTop = '1.5em';
            dayHeader.style.marginBottom = '1em';
            dayHeader.style.color = '#00ffcc';
            tableContainer.appendChild(dayHeader);

            // Tableau
            const table = document.createElement('table');
            table.className = 'priom-table';
            table.innerHTML = `
                <thead>
                    <tr>
                        <th>HEURE</th>
                        <th>STATION</th>
                        <th>FR√âQUENCE</th>
                        <th>MODE</th>
                        <th>REMARQUES</th>
                    </tr>
                </thead>
            `;
            const tbody = document.createElement('tbody');

            allEntries.forEach(entry => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td style="font-weight: 700; color: #00ffcc;">${entry.hour.slice(0, 2)}:${entry.hour.slice(2).padEnd(2, '0')}</td>
                    <td class="stn">${entry.name}</td>
                    <td>${entry.freq}</td>
                    <td>${entry.mode}</td>
                    <td>${entry.com}</td>
                `;
                tbody.appendChild(tr);
            });

            table.appendChild(tbody);
            tableContainer.appendChild(table);
        });

        wrapper.appendChild(tableContainer);
        scheduleContainer.innerHTML = '';
        scheduleContainer.appendChild(wrapper);

        // --- Horloge UTC ---
        function updateClock() {
            const now = new Date();
            const utc = now.toUTCString().split(' ')[4];
            document.getElementById('utc-time').textContent = utc;
        }
        setInterval(updateClock, 1000);
        updateClock();

    } catch (err) {
        scheduleContainer.innerHTML = `<p style="color: #ff3366; text-align: center; padding: 2em;">Erreur de chargement: ${err.message}</p>`;
    }
}

document.addEventListener('DOMContentLoaded', loadSchedule);
</script>

    <!-- Footer -->
    <footer>
        <p>
            <span id="footer-text">Cr√©√© par</span> <strong id="footer-studio">Discode Studio</strong> <span id="footer-heart">avec ‚ù§Ô∏è pour la communaut√© radio mondiale</span><br />
            <em id="footer-note">üîó Site ind√©pendant - Aucun lien avec KiwiSDR.com</em>
        </p>
    </footer>
    
    <!-- Translation Script -->
    <script>
        function updateTranslations() {
            // Navigation
            document.getElementById('nav-home').textContent = t('nav_home');
            document.getElementById('nav-schedule').textContent = t('nav_schedule') || 'Horaires';
            document.getElementById('nav-info').textContent = t('nav_info') || 'Infos';
            
            // Main content
            document.getElementById('schedule-title').textContent = t('schedule_title');
            document.getElementById('schedule-about').textContent = t('schedule_about');
            document.getElementById('schedule-about-desc').textContent = t('schedule_about_desc');
            
            // Footer
            document.getElementById('footer-text').textContent = t('footer_text');
            document.getElementById('footer-studio').textContent = t('footer_studio');
            document.getElementById('footer-heart').textContent = t('footer_heart');
            document.getElementById('footer-note').textContent = t('footer_note');
            
            // Update language button states
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('sel');
            });
            if (getCurrentLanguage() === 'fr') {
                document.querySelectorAll('.lang-btn')[0].classList.add('sel');
            } else {
                document.querySelectorAll('.lang-btn')[1].classList.add('sel');
            }
        }
        
        // Update on page load
        document.addEventListener('DOMContentLoaded', () => {
            updateTranslations();
            loadSchedule();
        });
    </script>
</body>
</html>
